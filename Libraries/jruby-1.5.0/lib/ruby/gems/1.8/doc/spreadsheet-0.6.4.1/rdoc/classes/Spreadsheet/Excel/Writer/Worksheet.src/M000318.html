<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>write_hlink (Spreadsheet::Excel::Writer::Worksheet)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/spreadsheet/excel/writer/worksheet.rb, line 487</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_hlink</span> <span class="ruby-identifier">row</span>, <span class="ruby-identifier">col</span>, <span class="ruby-identifier">link</span>
    <span class="ruby-comment cmt"># FIXME: only Hyperlinks are supported at present.</span>
    <span class="ruby-identifier">cell_range</span> = [
      <span class="ruby-identifier">row</span>, <span class="ruby-identifier">row</span>, <span class="ruby-comment cmt"># Cell range address of all cells containing this hyperlink</span>
      <span class="ruby-identifier">col</span>, <span class="ruby-identifier">col</span>, <span class="ruby-comment cmt"># (âžœ 3.13.1)</span>
    ].<span class="ruby-identifier">pack</span> <span class="ruby-value str">'v4'</span>
    <span class="ruby-identifier">guid</span> = [
      <span class="ruby-comment cmt"># GUID of StdLink:</span>
      <span class="ruby-comment cmt"># D0 C9 EA 79 F9 BA CE 11 8C 82 00 AA 00 4B A9 0B</span>
      <span class="ruby-comment cmt"># (79EAC9D0-BAF9-11CE-8C82-00AA004BA90B)</span>
      <span class="ruby-value str">&quot;d0c9ea79f9bace118c8200aa004ba90b&quot;</span>,
    ].<span class="ruby-identifier">pack</span> <span class="ruby-value str">'H32'</span>
    <span class="ruby-identifier">opts</span>  = <span class="ruby-value">0x01</span>
    <span class="ruby-identifier">opts</span> <span class="ruby-operator">|=</span> <span class="ruby-value">0x02</span>
    <span class="ruby-identifier">opts</span> <span class="ruby-operator">|=</span> <span class="ruby-value">0x14</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">link</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">url</span>
    <span class="ruby-identifier">opts</span> <span class="ruby-operator">|=</span> <span class="ruby-value">0x08</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">fragment</span>
    <span class="ruby-identifier">opts</span> <span class="ruby-operator">|=</span> <span class="ruby-value">0x80</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">target_frame</span>
    <span class="ruby-comment cmt"># TODO: UNC support</span>
    <span class="ruby-identifier">options</span> = [
      <span class="ruby-value">2</span>,        <span class="ruby-comment cmt"># Unknown value: 0x00000002</span>
      <span class="ruby-identifier">opts</span>,     <span class="ruby-comment cmt"># Option flags</span>
                <span class="ruby-comment cmt">#     Bit  Mask        Contents</span>
                <span class="ruby-comment cmt">#       0  0x00000001  0 = No link extant</span>
                <span class="ruby-comment cmt">#                      1 = File link or URL</span>
                <span class="ruby-comment cmt">#       1  0x00000002  0 = Relative file path</span>
                <span class="ruby-comment cmt">#                      1 = Absolute path or URL</span>
                <span class="ruby-comment cmt"># 2 and 4  0x00000014  0 = No description</span>
                <span class="ruby-comment cmt">#                      1 (both bits) = Description</span>
                <span class="ruby-comment cmt">#       3  0x00000008  0 = No text mark</span>
                <span class="ruby-comment cmt">#                      1 = Text mark</span>
                <span class="ruby-comment cmt">#       7  0x00000080  0 = No target frame</span>
                <span class="ruby-comment cmt">#                      1 = Target frame</span>
                <span class="ruby-comment cmt">#       8  0x00000100  0 = File link or URL</span>
                <span class="ruby-comment cmt">#                      1 = UNC path (incl. server name)</span>

    ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'V2'</span>)
    <span class="ruby-identifier">tail</span> = []
    <span class="ruby-comment cmt">## call internal to get the correct internal encoding in Ruby 1.9</span>
    <span class="ruby-identifier">nullstr</span> = <span class="ruby-identifier">internal</span> <span class="ruby-value str">&quot;\000&quot;</span>
    <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">link</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">url</span>
      <span class="ruby-identifier">desc</span> = <span class="ruby-identifier">internal</span>(<span class="ruby-identifier">link</span>).<span class="ruby-identifier">dup</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">nullstr</span>
      <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">desc</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'V'</span>), <span class="ruby-identifier">desc</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">target_frame</span>
      <span class="ruby-identifier">frme</span> = <span class="ruby-identifier">internal</span>(<span class="ruby-identifier">link</span>.<span class="ruby-identifier">target_frame</span>).<span class="ruby-identifier">dup</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">nullstr</span>
      <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">frme</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'V'</span>), <span class="ruby-identifier">frme</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">internal</span>(<span class="ruby-identifier">link</span>.<span class="ruby-identifier">url</span>).<span class="ruby-identifier">dup</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">nullstr</span>
    <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">push</span> [
      <span class="ruby-comment cmt"># 6.53.2 Hyperlink containing a URL (Uniform Resource Locator)</span>
      <span class="ruby-comment cmt"># These data fields occur for links which are not local files or files</span>
      <span class="ruby-comment cmt"># in the local network (for instance HTTP and FTP links and e-mail</span>
      <span class="ruby-comment cmt"># addresses). The lower 9 bits of the option flags field must be</span>
      <span class="ruby-comment cmt"># 0.x00x.xx112 (x means optional, depending on hyperlink content). The</span>
      <span class="ruby-comment cmt"># GUID could be used to distinguish a URL from a file link.</span>
      <span class="ruby-comment cmt"># GUID of URL Moniker:</span>
      <span class="ruby-comment cmt"># E0 C9 EA 79 F9 BA CE 11 8C 82 00 AA 00 4B A9 0B</span>
      <span class="ruby-comment cmt"># (79EAC9E0-BAF9-11CE-8C82-00AA004BA90B)</span>
      <span class="ruby-value str">'e0c9ea79f9bace118c8200aa004ba90b'</span>,
      <span class="ruby-identifier">url</span>.<span class="ruby-identifier">size</span>  <span class="ruby-comment cmt"># Size of character array of the URL, including trailing zero</span>
                <span class="ruby-comment cmt"># word (us). There are us/2-1 characters in the following</span>
                <span class="ruby-comment cmt"># string.</span>
    ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'H32V'</span>), <span class="ruby-identifier">url</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">fragment</span>
      <span class="ruby-identifier">frag</span> = <span class="ruby-identifier">internal</span>(<span class="ruby-identifier">link</span>.<span class="ruby-identifier">fragment</span>).<span class="ruby-identifier">dup</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">nullstr</span>
      <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">frag</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'V'</span>), <span class="ruby-identifier">frag</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">write_op</span> <span class="ruby-identifier">opcode</span>(<span class="ruby-identifier">:hlink</span>), <span class="ruby-identifier">cell_range</span>, <span class="ruby-identifier">guid</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">tail</span>
  <span class="ruby-keyword kw">end</span></pre>
</body>
</html>